<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>æ¥è‡ªå°æ‰¬çš„ AIåˆ†æç»“æœ</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        margin: 10px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        font-size: 16px;
        line-height: 1.6;
        /* ç¦æ­¢æ–‡æœ¬é€‰æ‹©ç¼©æ”¾ */
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
        text-size-adjust: 100%;
        /* ç¦æ­¢åŒå‡»ç¼©æ”¾ */
        touch-action: manipulation;
      }
      .container {
        max-width: 800px;
        margin: 0 auto;
        background-color: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
      }
      .message {
        margin: 20px 0;
        padding: 20px;
        border-left: 5px solid #007bff;
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
        border-radius: 10px;
        position: relative;
        transition: transform 0.2s ease;
      }
      .background-info {
        background: linear-gradient(145deg, #e8f4fd, #d1ecf1);
        margin: 30px 0;
        padding: 25px;
        border-radius: 15px;
        border-left: 5px solid #17a2b8;
        box-shadow: 0 4px 15px rgba(23, 162, 184, 0.1);
      }
      .background-title {
        font-size: 18px;
        font-weight: 600;
        color: #17a2b8;
        margin-bottom: 20px;
        text-align: center;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      }
      .background-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 12px;
        margin-bottom: 15px;
      }
      .background-item {
        background: rgba(255, 255, 255, 0.7);
        padding: 15px;
        border-radius: 10px;
        border: 1px solid rgba(23, 162, 184, 0.2);
        transition: all 0.3s ease;
      }
      .background-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(23, 162, 184, 0.2);
        background: rgba(255, 255, 255, 0.9);
      }
      .background-label {
        font-weight: 600;
        color: #495057;
        font-size: 13px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
      }
      .background-label::before {
        content: 'â—†';
        color: #17a2b8;
        margin-right: 8px;
        font-size: 12px;
      }
      .background-value {
        color: #333;
        font-size: 14px;
        line-height: 1.5;
        margin-left: 20px;
      }
      .emotional-summary {
        background: linear-gradient(145deg, #fff3cd, #ffeaa7);
        border: 1px solid #ffc107;
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        text-align: center;
      }
      .emotional-index-main {
        font-size: 24px;
        font-weight: bold;
        color: #856404;
        margin-bottom: 8px;
      }
      .emotional-reason {
        color: #856404;
        font-size: 13px;
        font-style: italic;
      }
      .message:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }
      .emotion-index {
        font-weight: bold;
        color: #007bff;
        margin-bottom: 12px;
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }
      .message-content {
        line-height: 1.8;
        margin-right: 70px;
        color: #333;
        white-space: pre-wrap;
        word-wrap: break-word;
        word-break: break-word;
      }
      .copy-btn {
        position: absolute;
        top: 15px;
        right: 15px;
        background: linear-gradient(145deg, #007bff, #0056b3);
        color: white;
        border: none;
        padding: 12px 18px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
        min-width: 70px;
        min-height: 48px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        /* å¢å¼ºè§¦æ‘¸ç›®æ ‡åŒºåŸŸå’Œä½“éªŒ */
        touch-action: manipulation;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        outline: none;
        /* é˜²æ­¢åŒå‡»ç¼©æ”¾ */
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
      }
      .copy-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.4);
      }
      .copy-btn:active {
        transform: translateY(0);
        /* ç§»åŠ¨ç«¯ç‚¹å‡»åé¦ˆ */
        background: linear-gradient(145deg, #0056b3, #004085);
        box-shadow: 0 1px 4px rgba(0, 123, 255, 0.4);
      }

      /* ç§»åŠ¨ç«¯è§¦æ‘¸ä¼˜åŒ– */
      @media (hover: none) and (pointer: coarse) {
        .copy-btn {
          min-height: 48px;
          min-width: 65px;
          font-size: 14px;
          font-weight: 600;
          padding: 12px 18px;
        }

        .copy-btn:active {
          transform: scale(0.95);
          transition: transform 0.1s ease;
        }
      }
      .copy-success {
        background: linear-gradient(145deg, #28a745, #20c997) !important;
        box-shadow: 0 2px 5px rgba(40, 167, 69, 0.3) !important;
      }
      .feedback-container {
        text-align: center;
        margin-top: 30px;
        padding: 20px;
        border-top: 2px dashed #e9ecef;
      }
      .feedback-btn {
        background: linear-gradient(145deg, #dc3545, #c82333);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 25px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
      }
      .feedback-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
      }
      .copy-animation {
        animation: copyPulse 0.6s ease-out;
      }
      @keyframes copyPulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 0 20px rgba(0, 123, 255, 0.6);
        }
        100% {
          transform: scale(1);
        }
      }
      .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        opacity: 0;
        transform: translateX(100px);
        transition: all 0.3s ease;
      }
      .toast.show {
        opacity: 1;
        transform: translateX(0);
      }
      .modal {
        display: none;
        position: fixed;
        z-index: 2000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
      }
      .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border-radius: 15px;
        width: 95%;
        max-width: 500px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: modalSlideIn 0.3s ease-out;
        max-height: 90vh;
        overflow-y: auto;
      }
      @keyframes modalSlideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .modal-header {
        text-align: center;
        margin-bottom: 20px;
        color: #333;
        font-size: 18px;
        font-weight: 500;
      }
      .modal-textarea {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 14px;
        font-family: inherit;
        resize: vertical;
        transition: border-color 0.3s ease;
        box-sizing: border-box;
      }
      .modal-textarea:focus {
        outline: none;
        border-color: #007bff;
        box-shadow: 0 0 10px rgba(0, 123, 255, 0.2);
      }
      .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }
      .modal-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
      }
      .modal-btn-primary {
        background: linear-gradient(145deg, #007bff, #0056b3);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
      }
      .modal-btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
      }
      .modal-btn-secondary {
        background: linear-gradient(145deg, #6c757d, #5a6268);
        color: white;
        box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
      }
      .modal-btn-secondary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
      }
      .emoji-hint {
        text-align: center;
        font-size: 12px;
        color: #666;
        margin-top: 10px;
        font-style: italic;
      }
      .feedback-options {
        margin: 15px 0;
      }
      .feedback-options-title {
        font-size: 14px;
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }
      .option-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
      }
      .option-btn {
        padding: 10px 14px;
        border: 2px solid #e9ecef;
        border-radius: 20px;
        background: white;
        color: #666;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.3s ease;
        user-select: none;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
      }
      .option-btn:hover {
        border-color: #007bff;
        color: #007bff;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
      }
      .option-btn.selected {
        border-color: #007bff;
        background: linear-gradient(145deg, #007bff, #0056b3);
        color: white;
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.3);
      }
      .option-btn.selected:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
      }
      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 20px;
        font-size: 28px;
        font-weight: 300;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .url-copy-banner {
        background: linear-gradient(145deg, #ff6b6b, #ee5a6f);
        padding: 15px 20px;
        border-radius: 12px;
        margin: 0 0 30px 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }
        50% {
          box-shadow: 0 6px 20px rgba(255, 107, 107, 0.5);
        }
      }
      .url-copy-text {
        color: white;
        font-size: 15px;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .url-copy-icon {
        font-size: 24px;
        animation: bounce 1s ease-in-out infinite;
      }
      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }
      .copy-url-btn {
        background: white;
        color: #ff6b6b;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 15px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        min-height: 48px;
        touch-action: manipulation;
        user-select: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .copy-url-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }
      .copy-url-btn:active {
        transform: translateY(0);
      }
      .copy-url-btn.copied {
        background: linear-gradient(145deg, #28a745, #20c997);
        color: white;
      }
      .loading {
        display: none;
        text-align: center;
        padding: 20px;
        color: #666;
      }

      /* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
      @media (max-width: 768px) {
        body {
          margin: 5px;
          font-size: 14px;
        }

        .container {
          padding: 15px;
          border-radius: 10px;
        }

        h1 {
          font-size: 22px;
          margin-bottom: 15px;
        }

        .url-copy-banner {
          flex-direction: column;
          gap: 12px;
          padding: 12px 15px;
          margin-bottom: 20px;
        }

        .url-copy-text {
          font-size: 14px;
          text-align: center;
        }

        .copy-url-btn {
          width: 100%;
          justify-content: center;
          padding: 14px 20px;
          font-size: 15px;
          min-height: 50px;
        }

        .message {
          margin: 15px 0;
          padding: 15px;
        }

        .message-content {
          margin-right: 80px;
          font-size: 14px;
        }

        .copy-btn {
          padding: 14px 20px;
          font-size: 15px;
          font-weight: 600;
          min-width: 80px;
          min-height: 52px;
          top: 12px;
          right: 12px;
          border-radius: 10px;
          /* ç§»åŠ¨ç«¯å¢å¼ºè§¦æ‘¸ä½“éªŒ */
          box-shadow: 0 3px 12px rgba(0, 123, 255, 0.4);
        }

        .background-grid {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .background-item {
          padding: 12px;
        }

        .background-label {
          font-size: 12px;
        }

        .background-value {
          font-size: 13px;
        }

        .feedback-btn {
          padding: 10px 20px;
          font-size: 13px;
        }

        .modal-content {
          margin: 2% auto;
          padding: 15px;
          width: 98%;
        }

        .modal-header {
          font-size: 16px;
        }

        .option-buttons {
          gap: 6px;
        }

        .option-btn {
          padding: 8px 12px;
          font-size: 12px;
          min-height: 40px;
        }

        .modal-textarea {
          padding: 12px;
          font-size: 13px;
        }

        .modal-btn {
          padding: 8px 16px;
          font-size: 13px;
        }

        .toast {
          top: 10px;
          right: 10px;
          padding: 10px 16px;
          font-size: 13px;
        }
      }

      /* è¶…å°å±å¹•ä¼˜åŒ– */
      @media (max-width: 480px) {
        body {
          margin: 2px;
        }

        .container {
          padding: 12px;
        }

        h1 {
          font-size: 20px;
        }

        .message {
          padding: 12px;
        }

        .message-content {
          margin-right: 85px;
          font-size: 13px;
        }

        .copy-btn {
          padding: 14px 18px;
          font-size: 14px;
          font-weight: 600;
          min-width: 75px;
          min-height: 52px;
          border-radius: 12px;
          /* è¶…å°å±å¹•ä¸Šå¢åŠ æ›´å¤§çš„è§¦æ‘¸åŒºåŸŸ */
          box-shadow: 0 3px 10px rgba(0, 123, 255, 0.4);
        }

        .background-item {
          padding: 10px;
        }

        .modal-content {
          padding: 12px;
        }

        .option-btn {
          flex: 1 1 calc(50% - 3px);
          min-width: 0;
        }
      }
    </style>
    <script>
      // å­˜å‚¨ chatId
      const CHAT_ID = 'XyPHZV'

      // æ”¹è¿›çš„å¤åˆ¶å‡½æ•° - ä½¿ç”¨dataå±æ€§é¿å…JavaScriptæ³¨å…¥
      function copyFromButton(button) {
        try {
          const text = button.getAttribute('data-content')
          const emotionalIndex = button.getAttribute('data-emotion')

          if (!text) {
            console.error('å¤åˆ¶å†…å®¹ä¸ºç©º')
            showToast('å¤åˆ¶å¤±è´¥ï¼šå†…å®¹ä¸ºç©º (â•¯Â°â–¡Â°ï¼‰â•¯')
            return
          }

          copyToClipboard(text, button, emotionalIndex)
        } catch (error) {
          console.error('å¤åˆ¶æ“ä½œå¤±è´¥:', error)
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·é‡è¯• (â•¯Â°â–¡Â°ï¼‰â•¯')
        }
      }

      function copyToClipboard(text, button, emotionalIndex) {
        // æ£€æŸ¥æŒ‰é’®æ˜¯å¦å·²ç»å‘é€è¿‡åé¦ˆè¯·æ±‚
        if (button.hasAttribute('data-feedback-sent')) {
          // åªæ‰§è¡Œå¤åˆ¶æ“ä½œï¼Œä¸å‘é€åé¦ˆ
          if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard
              .writeText(text)
              .then(function () {
                showCopySuccessWithoutFeedback(button)
              })
              .catch(function (err) {
                fallbackCopyTextToClipboardWithoutFeedback(text, button)
              })
          } else {
            fallbackCopyTextToClipboardWithoutFeedback(text, button)
          }
          return
        }

        // é¦–æ¬¡ç‚¹å‡»ï¼Œæ‰§è¡Œå¤åˆ¶å¹¶å‘é€åé¦ˆ
        if (navigator.clipboard && window.isSecureContext) {
          navigator.clipboard
            .writeText(text)
            .then(function () {
              showCopySuccess(button, text, emotionalIndex)
            })
            .catch(function (err) {
              fallbackCopyTextToClipboard(text, button, emotionalIndex)
            })
        } else {
          fallbackCopyTextToClipboard(text, button, emotionalIndex)
        }
      }

      function fallbackCopyTextToClipboard(text, button, emotionalIndex) {
        var textArea = document.createElement('textarea')
        textArea.value = text
        textArea.style.position = 'fixed'
        textArea.style.left = '-999999px'
        textArea.style.top = '-999999px'
        document.body.appendChild(textArea)
        textArea.focus()
        textArea.select()
        try {
          var successful = document.execCommand('copy')
          if (successful) {
            showCopySuccess(button, text, emotionalIndex)
          } else {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥: ', err)
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')
        }
        document.body.removeChild(textArea)
      }

      function fallbackCopyTextToClipboardWithoutFeedback(text, button) {
        var textArea = document.createElement('textarea')
        textArea.value = text
        textArea.style.position = 'fixed'
        textArea.style.left = '-999999px'
        textArea.style.top = '-999999px'
        document.body.appendChild(textArea)
        textArea.focus()
        textArea.select()
        try {
          var successful = document.execCommand('copy')
          if (successful) {
            showCopySuccessWithoutFeedback(button)
          } else {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥: ', err)
          alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶')
        }
        document.body.removeChild(textArea)
      }

      function showCopySuccess(button, text, emotionalIndex) {
        // æ·»åŠ å¤åˆ¶åŠ¨ç”»
        button.classList.add('copy-animation')

        // å›ºå®šæ˜¾ç¤ºæ‹¿èµ°ä¸è°¢çš„æ–‡æœ¬
        button.textContent = 'æ‹¿èµ°ä¸è°¢ (ï½¡â—•â€¿â—•ï½¡)'
        button.classList.add('copy-success')

        // å‘é€å¤åˆ¶è¯·æ±‚åˆ°åç«¯ï¼ŒåŒ…å«æƒ…æ„ŸæŒ‡æ•°
        sendFeedbackRequest(0, '', text, emotionalIndex)

        // æ ‡è®°è¯¥æŒ‰é’®å·²å‘é€è¿‡åé¦ˆ
        button.setAttribute('data-feedback-sent', 'true')

        setTimeout(function () {
          button.textContent = 'å¤åˆ¶'
          button.classList.remove('copy-success', 'copy-animation')
        }, 2000)
      }

      function showCopySuccessWithoutFeedback(button) {
        // æ·»åŠ å¤åˆ¶åŠ¨ç”»
        button.classList.add('copy-animation')

        // å›ºå®šæ˜¾ç¤ºæ‹¿èµ°ä¸è°¢çš„æ–‡æœ¬
        button.textContent = 'æ‹¿èµ°ä¸è°¢ (ï½¡â—•â€¿â—•ï½¡)'
        button.classList.add('copy-success')

        // ä¸å‘é€åé¦ˆè¯·æ±‚

        setTimeout(function () {
          button.textContent = 'å¤åˆ¶'
          button.classList.remove('copy-success', 'copy-animation')
        }, 2000)
      }

      function showFeedback() {
        // æ˜¾ç¤ºåé¦ˆå¼¹çª—
        document.getElementById('feedbackModal').style.display = 'block'
      }

      function closeFeedbackModal() {
        document.getElementById('feedbackModal').style.display = 'none'
        document.getElementById('feedbackText').value = ''
        // æ¸…é™¤æ‰€æœ‰é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.option-btn').forEach((btn) => {
          btn.classList.remove('selected')
        })
      }

      function selectOption(button, text) {
        // æ¸…é™¤å…¶ä»–é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.option-btn').forEach((btn) => {
          btn.classList.remove('selected')
        })

        // é€‰ä¸­å½“å‰é€‰é¡¹
        button.classList.add('selected')

        // å°†é€‰é¡¹æ–‡æœ¬å¡«å…¥æ–‡æœ¬æ¡†
        document.getElementById('feedbackText').value = text
      }

      function submitFeedback() {
        const feedbackText = document.getElementById('feedbackText').value.trim()
        const finalMessage = feedbackText || 'ç”¨æˆ·ä¸æ»¡æ„ç”Ÿæˆç»“æœ'

        // æ˜¾ç¤ºæ„Ÿè°¢æç¤º
        const thankMessages = [
          'æ‚¨çš„åŠè°æ˜¯æˆ‘ä»¬å‰è¿›çš„åŠ¨åŠ› (ï½¡â—•â€¿â—•ï½¡)',
          'æ„Ÿè°¢æ‚¨çš„å®è´µå»ºè®® â™ª(Â´â–½ï½€)',
          'æ‚¨çš„åé¦ˆè®©æˆ‘ä»¬æ›´åŠ åŠªåŠ› (â‰§âˆ€â‰¦)ã‚',
          'è°¢è°¢æ‚¨çš„è€å¿ƒæŒ‡å¯¼ (Â´âˆ€ï½€)â™¡',
          'æ‚¨çš„æ„è§éå¸¸çè´µ ãƒ½(Â°â–½Â°)ãƒ',
        ]
        const randomMessage = thankMessages[Math.floor(Math.random() * thankMessages.length)]
        showToast(randomMessage)

        // å‘é€åé¦ˆè¯·æ±‚åˆ°åç«¯
        sendFeedbackRequest(1, finalMessage, '', null)

        // å…³é—­å¼¹çª—
        closeFeedbackModal()
      }

      function sendFeedbackRequest(messageType, feedbackMessage, selectedText, emotionalIndex) {
        const requestData = {
          chatId: CHAT_ID,
          messageType: messageType, // 0: å¤åˆ¶, 1: ä¸æ»¡æ„åé¦ˆ
          feedBackMessage: feedbackMessage,
          resultStructure: {
            selectedText: selectedText || '',
            timestamp: new Date().toISOString(),
            emotionalIndex: emotionalIndex || null,
            additionalInfo: messageType === 0 ? 'ç”¨æˆ·å¤åˆ¶å†…å®¹' : 'ç”¨æˆ·åé¦ˆä¸æ»¡æ„',
          },
        }

        // å¢å¼ºé”™è¯¯å¤„ç†å’Œè¶…æ—¶æ§åˆ¶
        const controller = new AbortController()
        const timeoutId = setTimeout(() => controller.abort(), 10000) // 10ç§’è¶…æ—¶

        fetch('http://ddns.6010.top:12844/api/chat-ai/chat/user/feedback', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestData),
          signal: controller.signal,
        })
          .then((response) => {
            clearTimeout(timeoutId)
            if (response.ok) {
              console.log('åé¦ˆå‘é€æˆåŠŸ')
            } else {
              console.error('åé¦ˆå‘é€å¤±è´¥ - HTTPçŠ¶æ€:', response.status)
              // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
            }
          })
          .catch((error) => {
            clearTimeout(timeoutId)
            if (error.name === 'AbortError') {
              console.error('åé¦ˆå‘é€è¶…æ—¶')
            } else {
              console.error('å‘é€åé¦ˆæ—¶å‡ºé”™:', error)
            }
            // é™é»˜å¤±è´¥ï¼Œä¸å½±å“ç”¨æˆ·ä½“éªŒ
          })
      }

      function showToast(message) {
        // åˆ›å»ºtoastå…ƒç´ 
        const toast = document.createElement('div')
        toast.className = 'toast'
        toast.textContent = message
        document.body.appendChild(toast)

        // æ˜¾ç¤ºtoast
        setTimeout(() => {
          toast.classList.add('show')
        }, 100)

        // 3ç§’åéšè—å¹¶ç§»é™¤toast
        setTimeout(() => {
          toast.classList.remove('show')
          setTimeout(() => {
            if (document.body.contains(toast)) {
              document.body.removeChild(toast)
            }
          }, 300)
        }, 3000)
      }

      // å¤åˆ¶å½“å‰é¡µé¢URLåˆ°å‰ªè´´æ¿
      function copyCurrentUrl() {
        const currentUrl = window.location.href
        const button = event.target

        try {
          if (navigator.clipboard && window.isSecureContext) {
            // ç°ä»£æµè§ˆå™¨çš„Clipboard API
            navigator.clipboard
              .writeText(currentUrl)
              .then(() => {
                showUrlCopySuccess(button)
              })
              .catch((err) => {
                console.error('å¤åˆ¶URLå¤±è´¥:', err)
                fallbackCopyUrl(currentUrl, button)
              })
          } else {
            // é™çº§æ–¹æ¡ˆ
            fallbackCopyUrl(currentUrl, button)
          }
        } catch (error) {
          console.error('å¤åˆ¶æ“ä½œå¤±è´¥:', error)
          fallbackCopyUrl(currentUrl, button)
        }
      }

      // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ä¼ ç»Ÿæ–¹æ³•å¤åˆ¶URL
      function fallbackCopyUrl(url, button) {
        const textArea = document.createElement('textarea')
        textArea.value = url
        textArea.style.position = 'fixed'
        textArea.style.left = '-999999px'
        textArea.style.top = '-999999px'
        document.body.appendChild(textArea)
        textArea.focus()
        textArea.select()

        try {
          const successful = document.execCommand('copy')
          if (successful) {
            showUrlCopySuccess(button)
          } else {
            showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€æ é“¾æ¥ (â•¯Â°â–¡Â°ï¼‰â•¯')
          }
        } catch (err) {
          console.error('å¤åˆ¶å¤±è´¥:', err)
          showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€æ é“¾æ¥ (â•¯Â°â–¡Â°ï¼‰â•¯')
        }

        document.body.removeChild(textArea)
      }

      // æ˜¾ç¤ºURLå¤åˆ¶æˆåŠŸçŠ¶æ€
      function showUrlCopySuccess(button) {
        const originalText = button.innerHTML
        button.innerHTML = 'âœ… å·²å¤åˆ¶é“¾æ¥ï¼'
        button.classList.add('copied')

        showToast('ç½‘é¡µé“¾æ¥å·²å¤åˆ¶ï¼å¯ä»¥åˆ†äº«ç»™æœ‹å‹å•¦ â™ª(Â´â–½ï½€)')

        // 2.5ç§’åæ¢å¤åŸçŠ¶
        setTimeout(() => {
          button.innerHTML = originalText
          button.classList.remove('copied')
        }, 2500)
      }

      // ç¦æ­¢é¡µé¢ç¼©æ”¾çš„é¢å¤–é˜²æŠ¤
      document.addEventListener('gesturestart', function (e) {
        e.preventDefault()
      })

      document.addEventListener('gesturechange', function (e) {
        e.preventDefault()
      })

      document.addEventListener('gestureend', function (e) {
        e.preventDefault()
      })

      // é˜²æ­¢é”®ç›˜ç¼©æ”¾ï¼ˆCtrl + æ»šè½®ï¼‰
      document.addEventListener(
        'wheel',
        function (e) {
          if (e.ctrlKey) {
            e.preventDefault()
          }
        },
        { passive: false },
      )

      // é˜²æ­¢é”®ç›˜ç¼©æ”¾ï¼ˆCtrl + +/-ï¼‰
      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey && (e.key === '+' || e.key === '-' || e.key === '=' || e.key === '0')) {
          e.preventDefault()
        }
      })

      // é¡µé¢åŠ è½½å®Œæˆåçš„ä¼˜åŒ–
      document.addEventListener('DOMContentLoaded', function () {
        // æ·»åŠ æ·¡å…¥åŠ¨ç”»
        document.querySelector('.container').style.opacity = '0'
        document.querySelector('.container').style.transform = 'translateY(20px)'

        setTimeout(function () {
          document.querySelector('.container').style.transition = 'all 0.6s ease'
          document.querySelector('.container').style.opacity = '1'
          document.querySelector('.container').style.transform = 'translateY(0)'
        }, 100)

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­å¼¹çª—
        const modal = document.getElementById('feedbackModal')
        modal.addEventListener('click', function (e) {
          if (e.target === modal) {
            closeFeedbackModal()
          }
        })

        // ESCé”®å…³é—­å¼¹çª—
        document.addEventListener('keydown', function (e) {
          if (e.key === 'Escape' && modal.style.display === 'block') {
            closeFeedbackModal()
          }
        })
      })
    </script>
  </head>
  <body>
    <div class="container">
      <h1>æ¥è‡ªå°æ‰¬ (ï¼¾â–½ï¼¾)ï¼ çš„ AIèŠå¤©åˆ†æç»“æœ</h1>

      <!-- URLå¤åˆ¶æ¨ªå¹… -->
      <div class="url-copy-banner">
        <div class="url-copy-text">
          <span class="url-copy-icon">ğŸ“Œ</span>
          <span>ä¿å­˜æ­¤é¡µé¢é“¾æ¥ï¼Œéšæ—¶æŸ¥çœ‹åˆ†æç»“æœ</span>
        </div>
        <button class="copy-url-btn" onclick="copyCurrentUrl()" type="button">
          ğŸ“‹ å¤åˆ¶ç½‘é¡µé“¾æ¥
        </button>
      </div>

      <div class="background-info">
        <div class="background-title">ğŸ“Š èŠå¤©èƒŒæ™¯åˆ†æ</div>
        <div class="background-grid">
          <div class="background-item">
            <div class="background-label">å…³ç³»ç±»å‹</div>
            <div class="background-value">è¿½æ±‚å¼‚æ€§</div>
          </div>
          <div class="background-item">
            <div class="background-label">å¯¹è¯åœºæ™¯</div>
            <div class="background-value">æ ¡å›­å­¦ä¹ </div>
          </div>
          <div class="background-item">
            <div class="background-label">è¯é¢˜æ€§è´¨</div>
            <div class="background-value">è½»æ¾æ—¥å¸¸</div>
          </div>
          <div class="background-item">
            <div class="background-label">ç”¨æˆ·ç‰¹å¾</div>
            <div class="background-value">å¹½é»˜è°ƒä¾ƒ</div>
          </div>
        </div>
        <div class="emotional-summary">
          <div class="emotional-index-main">æ•´ä½“æƒ…æ„ŸæŒ‡æ•°: 8 åˆ†</div>
          <div class="emotional-reason">ç”¨è½»æ¾è°ƒä¾ƒå›åº”è€å¸ˆæ£€æŸ¥ï¼Œåˆ¶é€ è½»æ¾æš§æ˜§æ°›å›´</div>
        </div>
      </div>

      <div class="message">
        <div class="emotion-index">æƒ…ç»ªå€¼: 8</div>
        <div class="message-content">è¿™è€å¸ˆä¹Ÿå¤ªä¸¥æ ¼äº†ï¼Œè¿˜å¥½æˆ‘æœºæ™º[å¥¸ç¬‘]</div>
        <button
          class="copy-btn"
          type="button"
          data-content="è¿™è€å¸ˆä¹Ÿå¤ªä¸¥æ ¼äº†ï¼Œè¿˜å¥½æˆ‘æœºæ™º[å¥¸ç¬‘]"
          data-emotion="8"
          onclick="copyFromButton(this)"
        >
          å¤åˆ¶
        </button>
      </div>
      <div class="message">
        <div class="emotion-index">æƒ…ç»ªå€¼: 8</div>
        <div class="message-content">é›ªè±¹éƒ½å—ä¸äº†è¿™ä¹ˆè®¤çœŸçš„è€å¸ˆ[æ—ºæŸ´]</div>
        <button
          class="copy-btn"
          type="button"
          data-content="é›ªè±¹éƒ½å—ä¸äº†è¿™ä¹ˆè®¤çœŸçš„è€å¸ˆ[æ—ºæŸ´]"
          data-emotion="8"
          onclick="copyFromButton(this)"
        >
          å¤åˆ¶
        </button>
      </div>
      <div class="message">
        <div class="emotion-index">æƒ…ç»ªå€¼: 8</div>
        <div class="message-content">çœ‹æ¥æˆ‘ä»¬éœ€è¦å»ºç«‹æ›´ç¨³å®šçš„é“¾æ¥äº†[å·ç¬‘]</div>
        <button
          class="copy-btn"
          type="button"
          data-content="çœ‹æ¥æˆ‘ä»¬éœ€è¦å»ºç«‹æ›´ç¨³å®šçš„é“¾æ¥äº†[å·ç¬‘]"
          data-emotion="8"
          onclick="copyFromButton(this)"
        >
          å¤åˆ¶
        </button>
      </div>

      <div class="feedback-container">
        <button class="feedback-btn" onclick="showFeedback()">æˆ‘ä¸æ»¡æ„ç”Ÿæˆç»“æœ (â•¯ï¸µâ•°)</button>
      </div>
    </div>

    <!-- åé¦ˆå¼¹çª— -->
    <div id="feedbackModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">å‘Šè¯‰å°æ‰¬å“ªé‡Œéœ€è¦æ”¹è¿›å§ (Â´ï½¥Ï‰ï½¥`)</div>

        <div class="feedback-options">
          <div class="feedback-options-title">å¿«é€Ÿé€‰æ‹©å¸¸è§é—®é¢˜ Ù©(â—•â€¿â—•)Û¶</div>
          <div class="option-buttons">
            <div
              class="option-btn"
              onclick='selectOption(this, "åˆ†æä¸å¤Ÿè¯¦ç»†ï¼Œå¸Œæœ›æ›´æ·±å…¥ä¸€äº› ãƒ½(ï½`çš¿â€²ï½)ï¾‰")'
            >
              åˆ†æä¸å¤Ÿè¯¦ç»† ãƒ½(ï½`çš¿â€²ï½)ï¾‰
            </div>
            <div
              class="option-btn"
              onclick='selectOption(this, "æƒ…ç»ªåˆ¤æ–­æœ‰è¯¯ï¼Œå®é™…æ„Ÿå—ä¸æ˜¯è¿™æ · (ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)")'
            >
              æƒ…ç»ªåˆ¤æ–­æœ‰è¯¯ (ï½¡â€¢Ìï¸¿â€¢Ì€ï½¡)
            </div>
            <div
              class="option-btn"
              onclick='selectOption(this, "å¸Œæœ›æ›´åŠ ä¸“ä¸šä¸€äº› â•°( Í¡Â° ÍœÊ– Í¡Â° )ã¤â”€â”€â˜†*:ãƒ»ï¾Ÿ")'
            >
              å¸Œæœ›æ›´åŠ ä¸“ä¸š (ï½¡â—•â€¿â—•ï½¡)
            </div>
            <div
              class="option-btn"
              onclick='selectOption(this, "å†…å®¹å¤ªç®€å•äº†ï¼Œéœ€è¦æ›´å¤šç»†èŠ‚ (ï¿£â–½ï¿£)")'
            >
              å†…å®¹å¤ªç®€å• (ï¿£â–½ï¿£)
            </div>
            <div
              class="option-btn"
              onclick='selectOption(this, "åˆ†æè§’åº¦å•ä¸€ï¼Œå¸Œæœ›å¤šå…ƒåŒ– â™ª(Â´â–½ï½€)")'
            >
              åˆ†æè§’åº¦å•ä¸€ â™ª(Â´â–½ï½€)
            </div>
            <div class="option-btn" onclick='selectOption(this, "è¯­è¨€é£æ ¼ä¸ç¬¦åˆé¢„æœŸ (Â¬_Â¬)")'>
              è¯­è¨€é£æ ¼é—®é¢˜ (Â¬_Â¬)
            </div>
            <div class="option-btn" onclick='selectOption(this, "è¯†åˆ«å‡†ç¡®åº¦æœ‰å¾…æå‡ (ï½¡â€¢Ë‡â€¸Ë‡â€¢ï½¡)")'>
              è¯†åˆ«å‡†ç¡®åº¦é—®é¢˜ (ï½¡â€¢Ë‡â€¸Ë‡â€¢ï½¡)
            </div>
            <div class="option-btn" onclick='selectOption(this, "å“åº”é€Ÿåº¦å¤ªæ…¢äº† (â•¯Â°â–¡Â°ï¼‰â•¯")'>
              å“åº”é€Ÿåº¦æ…¢ (â•¯Â°â–¡Â°ï¼‰â•¯
            </div>
          </div>
        </div>

        <textarea
          id="feedbackText"
          class="modal-textarea"
          placeholder="æ‚¨ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè¾“å…¥è‡ªå®šä¹‰çš„å»ºè®®æˆ–æ„è§... é€‰æ‹©ä¸Šé¢çš„é€‰é¡¹ä¼šè‡ªåŠ¨å¡«å…¥å“¦ (â—•â€¿â—•)âœ¨&#10;&#10;å½“ç„¶ï¼Œä¸è¾“å…¥ä»»ä½•å†…å®¹ä¹Ÿå®Œå…¨OKï½"
        ></textarea>
        <div class="emoji-hint">
          æ‚¨çš„æ¯ä¸€ä¸ªå»ºè®®éƒ½æ˜¯å°æ‰¬è¿›æ­¥çš„é˜¶æ¢¯ â™ª(Â´â–½ï½€) ä¸è¾“å…¥å†…å®¹ä¹Ÿå®Œå…¨OKå“¦ï½
        </div>
        <div class="modal-buttons">
          <button class="modal-btn modal-btn-secondary" onclick="closeFeedbackModal()">
            ç®—äº†ï¼Œä¸è¯´äº† (ï¿£â–½ï¿£)
          </button>
          <button class="modal-btn modal-btn-primary" onclick="submitFeedback()">
            æäº¤åé¦ˆ Ù©(â—•â€¿â—•)Û¶
          </button>
        </div>
      </div>
    </div>
  </body>
</html>
